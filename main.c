#include <gb/gb.h>

#define num uint8_t
#define snum int8_t
#define num16 uint16_t
#define snum16 int16_t

unsigned char tiles[] =
{
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0xFC,0xFC,0xF8,0xF8,0xF0,0xF0,0xF8,0xF8,
  0xDC,0xDC,0x8E,0x8E,0x06,0x06,0x00,0x00,
  0x20,0x20,0x30,0x30,0x38,0x38,0x3C,0x3C,
  0x38,0x38,0x30,0x30,0x20,0x20,0x00,0x00,
  0x04,0x04,0x0C,0x0C,0x1C,0x1C,0x3C,0x3C,
  0x1C,0x1C,0x0C,0x0C,0x04,0x04,0x00,0x00,
  0x00,0x00,0x1F,0x1F,0x1F,0x10,0x1F,0x10,
  0x1F,0x10,0x1F,0x10,0x1F,0x10,0x1F,0x10,
  0x1F,0x10,0x1F,0x10,0x1F,0x10,0x1F,0x10,
  0x1E,0x11,0x10,0x1F,0x1F,0x1F,0x00,0x00,
  0x00,0x00,0x80,0x80,0xC0,0xC0,0xE0,0xA0,
  0xF0,0x90,0xF8,0xF8,0xE8,0x18,0xE8,0x18,
  0xE8,0x18,0xC8,0x38,0xC8,0x38,0x88,0x78,
  0x08,0xF8,0x08,0xF8,0xF8,0xF8,0x00,0x00,
  0x00,0x00,0x7F,0x7F,0x7F,0x50,0x7F,0x50,
  0x7F,0x50,0x7F,0x50,0x7F,0x50,0x70,0x5F,
  0x7F,0x5F,0x7F,0x40,0x7F,0x47,0x78,0x4F,
  0x7A,0x4F,0x4A,0x7F,0x3F,0x3F,0x00,0x00,
  0x00,0x00,0xFE,0xFE,0xEA,0x1E,0xEA,0x1E,
  0xEA,0x1E,0xEA,0x1E,0xCA,0x3E,0x0A,0xFE,
  0xFA,0xFE,0xFA,0x06,0xFA,0xE6,0x1A,0xF6,
  0x12,0xFE,0x12,0xFE,0xFE,0xFE,0x00,0x00,
  0x00,0x00,0x1F,0x1F,0x1F,0x10,0x1F,0x12,
  0x1F,0x10,0x1F,0x16,0x1F,0x10,0x1F,0x17,
  0x1F,0x10,0x1F,0x17,0x1F,0x10,0x1F,0x15,
  0x1E,0x11,0x10,0x1F,0x1F,0x1F,0x00,0x00,
  0x00,0x00,0x80,0x80,0xC0,0xC0,0xE0,0xA0,
  0xF0,0x90,0xF8,0xF8,0xE8,0x18,0xE8,0xF8,
  0xE8,0x18,0xE8,0x78,0xC8,0x38,0xA8,0xF8,
  0x08,0xF8,0x08,0xF8,0xF8,0xF8,0x00,0x00,
  0x00,0x00,0x1F,0x1F,0x3F,0x21,0x7F,0x49,
  0x7F,0x5D,0x7F,0x49,0x7D,0x43,0x79,0x47,
  0x7F,0x7F,0x7F,0x41,0x7F,0x41,0x7F,0x5D,
  0x7D,0x43,0x39,0x27,0x1F,0x1F,0x00,0x00,
  0x00,0x00,0xF8,0xF8,0xF4,0x0C,0xC2,0x3E,
  0x82,0x7E,0x82,0x7E,0x02,0xFE,0x3A,0xFE,
  0x02,0xFE,0x3A,0xFE,0x02,0xFE,0x02,0xFE,
  0x02,0xFE,0x04,0xFC,0xF8,0xF8,0x00,0x00,
  0xFF,0xFF,0xFE,0xFE,0xFC,0xFC,0xF8,0xF8,
  0xF0,0xF0,0xE0,0xE0,0xC0,0xC0,0x80,0x80,
  0xFF,0xFF,0x7F,0x7F,0x3F,0x3F,0x1F,0x1F,
  0x0F,0x0F,0x07,0x07,0x03,0x03,0x01,0x01,
  0x80,0x80,0xC0,0xC0,0xE0,0xE0,0xF0,0xF0,
  0xF8,0xF8,0xFC,0xFC,0xFE,0xFE,0xFF,0xFF,
  0x01,0x01,0x03,0x03,0x07,0x07,0x0F,0x0F,
  0x1F,0x1F,0x3F,0x3F,0x7F,0x7F,0xFF,0xFF,
  0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
  0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
  0x3C,0x3C,0x7E,0x7E,0xFF,0xFF,0xFF,0xFF,
  0xFF,0xFF,0xFF,0xFF,0x7E,0x7E,0x3C,0x3C,
  0x07,0x07,0x1F,0x1F,0x3F,0x3F,0x7F,0x7F,
  0x7F,0x7F,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
  0xE0,0xE0,0xF8,0xF8,0xFC,0xFC,0xFE,0xFE,
  0xFE,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
  0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x7F,0x7F,
  0x7F,0x7F,0x3F,0x3F,0x1F,0x1F,0x07,0x07,
  0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0xFE,
  0xFE,0xFE,0xFC,0xFC,0xF8,0xF8,0xE0,0xE0,
  0x00,0x00,0x24,0x24,0x24,0x24,0x24,0x24,
  0x00,0x00,0x42,0x42,0x3C,0x3C,0x00,0x00,
  0x00,0x00,0x24,0x24,0x24,0x24,0x24,0x24,
  0x00,0x00,0x3C,0x3C,0x42,0x42,0x00,0x00,
  0x00,0x00,0x24,0x24,0x24,0x24,0x24,0x24,
  0x00,0x00,0x7E,0x7E,0x00,0x00,0x00,0x00,
  0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,
  0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,
  0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,
  0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,
  0x18,0x18,0x18,0x18,0x18,0x18,0x1F,0x1F,
  0x1F,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,
  0x18,0x18,0x18,0x18,0x18,0x18,0xF8,0xF8,
  0xF8,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0x1F,
  0x1F,0x1F,0x18,0x18,0x18,0x18,0x18,0x18,
  0x00,0x00,0x00,0x00,0x00,0x00,0xF8,0xF8,
  0xF8,0xF8,0x18,0x18,0x18,0x18,0x18,0x18,
  0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,
  0xFF,0xFF,0x18,0x18,0x18,0x18,0x18,0x18,
  0x18,0x18,0x18,0x18,0x18,0x18,0xFF,0xFF,
  0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,
  0x18,0x18,0x18,0x18,0x18,0x18,0x1F,0x1F,
  0x1F,0x1F,0x18,0x18,0x18,0x18,0x18,0x18,
  0x18,0x18,0x18,0x18,0x18,0x18,0xF8,0xF8,
  0xF8,0xF8,0x18,0x18,0x18,0x18,0x18,0x18,
  0x18,0x18,0x18,0x18,0x18,0x18,0xFF,0xFF,
  0xFF,0xFF,0x18,0x18,0x18,0x18,0x18,0x18,
  0x00,0x00,0x3C,0x3C,0x42,0x42,0x42,0x42,
  0x7E,0x7E,0x42,0x42,0x42,0x42,0x00,0x00,
  0x00,0x00,0x7C,0x7C,0x42,0x42,0x7C,0x7C,
  0x42,0x42,0x42,0x42,0x7C,0x7C,0x00,0x00,
  0x00,0x00,0x3C,0x3C,0x42,0x42,0x40,0x40,
  0x40,0x40,0x42,0x42,0x3C,0x3C,0x00,0x00,
  0x00,0x00,0x7C,0x7C,0x42,0x42,0x42,0x42,
  0x42,0x42,0x42,0x42,0x7C,0x7C,0x00,0x00,
  0x00,0x00,0x7E,0x7E,0x40,0x40,0x78,0x78,
  0x40,0x40,0x40,0x40,0x7E,0x7E,0x00,0x00,
  0x00,0x00,0x7E,0x7E,0x40,0x40,0x78,0x78,
  0x40,0x40,0x40,0x40,0x40,0x40,0x00,0x00,
  0x00,0x00,0x3C,0x3C,0x42,0x42,0x40,0x40,
  0x4E,0x4E,0x42,0x42,0x3C,0x3C,0x00,0x00,
  0x00,0x00,0x42,0x42,0x42,0x42,0x7E,0x7E,
  0x42,0x42,0x42,0x42,0x42,0x42,0x00,0x00,
  0x00,0x00,0x38,0x38,0x10,0x10,0x10,0x10,
  0x10,0x10,0x10,0x10,0x38,0x38,0x00,0x00,
  0x00,0x00,0x02,0x02,0x02,0x02,0x02,0x02,
  0x02,0x02,0x42,0x42,0x3C,0x3C,0x00,0x00,
  0x00,0x00,0x44,0x44,0x48,0x48,0x70,0x70,
  0x48,0x48,0x44,0x44,0x42,0x42,0x00,0x00,
  0x00,0x00,0x40,0x40,0x40,0x40,0x40,0x40,
  0x40,0x40,0x40,0x40,0x7E,0x7E,0x00,0x00,
  0x00,0x00,0x42,0x42,0x66,0x66,0x5A,0x5A,
  0x42,0x42,0x42,0x42,0x42,0x42,0x00,0x00,
  0x00,0x00,0x42,0x42,0x62,0x62,0x52,0x52,
  0x4A,0x4A,0x46,0x46,0x42,0x42,0x00,0x00,
  0x00,0x00,0x3C,0x3C,0x42,0x42,0x42,0x42,
  0x42,0x42,0x42,0x42,0x3C,0x3C,0x00,0x00,
  0x00,0x00,0x7C,0x7C,0x42,0x42,0x7C,0x7C,
  0x40,0x40,0x40,0x40,0x40,0x40,0x00,0x00,
  0x00,0x00,0x3C,0x3C,0x42,0x42,0x42,0x42,
  0x4A,0x4A,0x44,0x44,0x3A,0x3A,0x00,0x00,
  0x00,0x00,0x7C,0x7C,0x42,0x42,0x7C,0x7C,
  0x48,0x48,0x44,0x44,0x42,0x42,0x00,0x00,
  0x00,0x00,0x3E,0x3E,0x40,0x40,0x3C,0x3C,
  0x02,0x02,0x42,0x42,0x3C,0x3C,0x00,0x00,
  0x00,0x00,0x7C,0x7C,0x10,0x10,0x10,0x10,
  0x10,0x10,0x10,0x10,0x10,0x10,0x00,0x00,
  0x00,0x00,0x42,0x42,0x42,0x42,0x42,0x42,
  0x42,0x42,0x42,0x42,0x3C,0x3C,0x00,0x00,
  0x00,0x00,0x44,0x44,0x44,0x44,0x44,0x44,
  0x44,0x44,0x28,0x28,0x10,0x10,0x00,0x00,
  0x00,0x00,0x42,0x42,0x42,0x42,0x42,0x42,
  0x5A,0x5A,0x66,0x66,0x42,0x42,0x00,0x00,
  0x00,0x00,0x42,0x42,0x24,0x24,0x18,0x18,
  0x18,0x18,0x24,0x24,0x42,0x42,0x00,0x00,
  0x00,0x00,0x44,0x44,0x28,0x28,0x10,0x10,
  0x10,0x10,0x10,0x10,0x10,0x10,0x00,0x00,
  0x00,0x00,0x7E,0x7E,0x04,0x04,0x08,0x08,
  0x10,0x10,0x20,0x20,0x7E,0x7E,0x00,0x00,
  0x00,0x00,0x3C,0x3C,0x46,0x46,0x4A,0x4A,
  0x52,0x52,0x62,0x62,0x3C,0x3C,0x00,0x00,
  0x00,0x00,0x10,0x10,0x30,0x30,0x50,0x50,
  0x10,0x10,0x10,0x10,0x7C,0x7C,0x00,0x00,
  0x00,0x00,0x3C,0x3C,0x42,0x42,0x0C,0x0C,
  0x30,0x30,0x40,0x40,0x7E,0x7E,0x00,0x00,
  0x00,0x00,0x3C,0x3C,0x42,0x42,0x1C,0x1C,
  0x02,0x02,0x42,0x42,0x3C,0x3C,0x00,0x00,
  0x00,0x00,0x08,0x08,0x18,0x18,0x28,0x28,
  0x48,0x48,0x7E,0x7E,0x08,0x08,0x00,0x00,
  0x00,0x00,0x7E,0x7E,0x40,0x40,0x7C,0x7C,
  0x02,0x02,0x42,0x42,0x3C,0x3C,0x00,0x00,
  0x00,0x00,0x3E,0x3E,0x40,0x40,0x7C,0x7C,
  0x42,0x42,0x42,0x42,0x3C,0x3C,0x00,0x00,
  0x00,0x00,0x7E,0x7E,0x02,0x02,0x04,0x04,
  0x08,0x08,0x10,0x10,0x20,0x20,0x00,0x00,
  0x00,0x00,0x3C,0x3C,0x42,0x42,0x3C,0x3C,
  0x42,0x42,0x42,0x42,0x3C,0x3C,0x00,0x00,
  0x00,0x00,0x3C,0x3C,0x42,0x42,0x42,0x42,
  0x3E,0x3E,0x02,0x02,0x7C,0x7C,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x10,0x10,0x00,0x00,
  0x00,0x00,0x38,0x38,0x04,0x04,0x08,0x08,
  0x10,0x10,0x00,0x00,0x10,0x10,0x00,0x00,
  0x00,0x00,0x10,0x10,0x10,0x10,0x10,0x10,
  0x10,0x10,0x00,0x00,0x10,0x10,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x08,0x08,0x10,0x10,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x10,
  0x00,0x00,0x00,0x00,0x10,0x10,0x00,0x00,
  0x00,0x00,0x00,0x00,0x10,0x10,0x00,0x00,
  0x00,0x00,0x10,0x10,0x20,0x20,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x7C,0x7C,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x10,0x10,0x10,0x10,
  0x7C,0x7C,0x10,0x10,0x10,0x10,0x00,0x00,
  0x00,0x00,0x00,0x00,0x44,0x44,0x28,0x28,
  0x10,0x10,0x28,0x28,0x44,0x44,0x00,0x00,
  0x00,0x00,0x00,0x00,0x10,0x10,0x00,0x00,
  0x7C,0x7C,0x00,0x00,0x10,0x10,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x7C,
  0x00,0x00,0x7C,0x7C,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x42,0x42,0x7E,0x7E,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x3E,0x00,0x7F,0x00,0x3E,0x00,
  0x00,0x00,0x02,0x00,0x07,0x00,0x07,0x00,
  0x07,0x00,0x07,0x00,0x07,0x00,0x02,0x00,
  0x00,0x00,0x20,0x00,0x70,0x00,0x70,0x00,
  0x70,0x00,0x70,0x00,0x70,0x00,0x20,0x00,
  0x3E,0x00,0x7F,0x00,0x3E,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x3E,0x3E,0x7F,0x7F,0x3E,0x3E,
  0x00,0x00,0x02,0x02,0x07,0x07,0x07,0x07,
  0x07,0x07,0x07,0x07,0x07,0x07,0x02,0x02,
  0x00,0x00,0x20,0x20,0x70,0x70,0x70,0x70,
  0x70,0x70,0x70,0x70,0x70,0x70,0x20,0x20,
  0x3E,0x3E,0x7F,0x7F,0x3E,0x3E,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x7F,0x00,0x3E,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x3E,0x00,
  0x7F,0x7F,0x3E,0x3E,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x3E,0x3E,
  0x07,0x07,0x04,0x04,0x1F,0x1F,0x7F,0x7F,
  0x00,0x00,0x1F,0x1F,0x1F,0x1F,0x1A,0x1A,
  0x1A,0x1A,0x1A,0x1A,0x1A,0x1A,0x1A,0x1A,
  0x1A,0x1A,0x1F,0x1F,0x0F,0x0F,0x07,0x07,
  0xC0,0xC0,0x40,0x40,0xF0,0xF0,0xFC,0xFC,
  0x00,0x00,0xF0,0xF0,0xF0,0xF0,0xB0,0xB0,
  0xB0,0xB0,0xB0,0xB0,0xB0,0xB0,0xB0,0xB0,
  0xB0,0xB0,0xF0,0xF0,0xE0,0xE0,0xC0,0xC0
};

num bar[] = {
    34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34
};
num settingsText[] = {
    62,48,63,63,52,57,50,62
};
num fileEditorText[] = {
    49,52,55,48,0,48,47,52,63,58,61
};
num calculatorText[] = {
    46,44,55,46,64,55,44,63,58,61
};
num digital[11][12] = {
    {
        0,96,0,97,101,98,97,100,98,0,99,0
    },
    {
        0,92,0,93,101,98,93,100,98,0,95,0
    },
    {
        0,96,0,93,103,98,97,102,94,0,99,0
    },
    {
        0,96,0,93,103,98,93,102,98,0,99,0
    },
    {
        0,92,0,97,103,98,93,102,98,0,95,0
    },
    {
        0,96,0,97,103,94,93,102,98,0,99,0
    },
    {
        0,96,0,97,103,94,97,102,98,0,99,0
    },
    {
        0,96,0,93,101,98,93,100,98,0,95,0
    },
    {
        0,96,0,97,103,98,97,102,98,0,99,0
    },
    {
        0,96,0,97,103,98,93,102,98,0,99,0
    },
    {
        0,92,0,93,101,94,93,100,94,0,95,0
    }
};
num blank[20*18];
num calc[] =
{
  0x25,0x22,0x22,0x22,0x22,0x22,0x22,0x22,0x22,0x22,
  0x22,0x22,0x22,0x22,0x22,0x22,0x22,0x26,0x21,0x00,
  0x00,0x00,0x00,0x5C,0x00,0x00,0x5C,0x00,0x00,0x5C,
  0x00,0x00,0x5C,0x00,0x00,0x21,0x21,0x00,0x00,0x00,
  0x5D,0x65,0x5E,0x5D,0x65,0x5E,0x5D,0x65,0x5E,0x5D,
  0x65,0x5E,0x00,0x21,0x21,0x00,0x00,0x00,0x5D,0x64,
  0x5E,0x5D,0x64,0x5E,0x5D,0x64,0x5E,0x5D,0x64,0x5E,
  0x00,0x21,0x21,0x00,0x00,0x00,0x00,0x5F,0x00,0x00,
  0x5F,0x00,0x00,0x5F,0x00,0x00,0x5F,0x00,0x00,0x21,
  0x29,0x22,0x22,0x22,0x22,0x22,0x22,0x22,0x27,0x22,
  0x22,0x22,0x22,0x22,0x22,0x22,0x22,0x2A,0x21,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x21,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x21,0x21,0x00,0x4D,0x00,
  0x4E,0x00,0x4F,0x00,0x21,0x00,0x2E,0x30,0x00,0x57,
  0x00,0x56,0x00,0x21,0x21,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x21,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x21,0x21,0x00,0x4A,0x00,0x4B,0x00,0x4C,0x00,
  0x21,0x00,0x00,0x00,0x00,0x58,0x00,0x59,0x00,0x21,
  0x21,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x21,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x21,0x21,0x00,
  0x47,0x00,0x48,0x00,0x49,0x00,0x21,0x00,0x00,0x00,
  0x00,0x00,0x00,0x5A,0x00,0x21,0x21,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x21,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x21,0x21,0x00,0x2E,0x00,0x46,0x00,
  0x03,0x00,0x21,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x21,0x21,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x21,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x21,
  0x23,0x22,0x22,0x22,0x22,0x22,0x22,0x22,0x28,0x22,
  0x22,0x22,0x22,0x22,0x22,0x22,0x22,0x24
};
num texteditToolbar[] = {
    3,0,2,0,71,72,73,74,75,76
};
num trashBin[] = {
    104,106,105,107
};

num cursorPosX = 0;
num cursorPosY = 0;
snum grabbedSprite = -1;
snum prevHoveredIcon = -1;
num openedApp = 0;
num cursorLimitUp = 0;
num cursorLimitLeft = 0;
num cursorLimitDown = 143;
num cursorLimitRight = 159;

num pressed;
num justpressed;

num iconPositions[18];
num hidden[9];
num emptyFiles[6] = { 1, 1, 1, 1, 1, 1 };
num fileData[7][320];

num textCursorPosX = 0;
num textCursorPosY = 0;
num currentCharacter = 44;

num16 calcNumber = 0;
num16 calcNumber1 = 0;
num16 calcNumber2 = 0;
num operation = 0;

num *saved = 0xA000;

void moveSprite(num id, num x, num y) {
    hidden[id] = 0;
    iconPositions[id * 2] = x;
    iconPositions[id * 2 + 1] = y;
    id = 39 - id * 4;
    move_sprite(id, x + 8, y + 16);
    move_sprite(id - 1, x + 8, y + 24);
    move_sprite(id - 2, x + 16, y + 16);
    move_sprite(id - 3, x + 16, y + 24);
}

void addSprite(num id, num tile, num x, num y) {
    num ID = 39 - id * 4;
    set_sprite_tile(ID, tile);
    set_sprite_tile(ID - 1, tile + 1);
    set_sprite_tile(ID - 2, tile + 2);
    set_sprite_tile(ID - 3, tile + 3);
    moveSprite(id, x, y);
}

void hideSprite(num id) {
    hidden[id] = 1;
    id = 39 - id * 4;
    hide_sprite(id); 
    hide_sprite(id - 1); 
    hide_sprite(id - 2); 
    hide_sprite(id - 3);
}

num getSpriteX(num id) {
    return iconPositions[id * 2];
}

num getSpriteY(num id) {
    return iconPositions[id * 2 + 1];
}

void showSprite(num id) {
    moveSprite(id, getSpriteX(id), getSpriteY(id));
}

void drawText(char *text, num x, num y) {
    num i = 0;
    num len = 0;
    while (text[i] != 0) {
        len++;
        i++;
    }
    num textTiles[20];
    for (i = 0; i < len; i++) {
        num character = text[i];
        if (character >= 'a' && character <= 'z') textTiles[i] = character - 'a' + 44;
        else if (character >= 'A' && character <= 'Z') textTiles[i] = character - 'A' + 44;
        else if (character >= '0' && character <= '9') textTiles[i] = character - '0' + 70;
        else textTiles[i] = 0;
    }
    set_bkg_tiles(x, y, len, 1, textTiles);
}

void drawSegmentedDisplay(num16 number, num x, num y) {
    num thousand = number / 1000 % 10;
    num hundred = number / 100 % 10;
    num ten = number / 10 % 10;
    num one = number % 10;
    if (thousand == 0) thousand = 10;
    if (hundred == 0 && thousand == 10) hundred = 10;
    if (ten == 0 && hundred == 10) ten = 10;
    set_bkg_tiles(x, y, 3, 4, digital[thousand]);
    set_bkg_tiles(x + 3, y, 3, 4, digital[hundred]);
    set_bkg_tiles(x + 6, y, 3, 4, digital[ten]);
    set_bkg_tiles(x + 9, y, 3, 4, digital[one]);
}

void handleInput() {
    justpressed = 0;
    num input = joypad();
    num i;
    for (i = 0; i < 8; i++) {
        if (input & (1 << i) && !(pressed & (1 << i))) justpressed |= 1 << i;
    }
    pressed = input;
}

int main() {
    ENABLE_RAM_MBC5;
    num i;
    set_bkg_data(0, sizeof(tiles) / 16, tiles);
    set_sprite_data(0, sizeof(tiles) / 16, tiles);
    set_bkg_tiles(0, 0, 20, 18, blank);
    set_bkg_tiles(18, 0, 2, 2, trashBin);
    set_bkg_tiles(0, 16, 20, 1, bar);
    set_sprite_tile(0, 1);
    set_sprite_tile(1, 91);
    for (i = 0; i < 6; i++) {
        addSprite(i, 0x04, 8 + i * 16, 24 + i * 4);
        hideSprite(i);
    }
    addSprite(6, 0x08, 8, 104);
    addSprite(7, 0x0C, 24, 104);
    addSprite(8, 0x10, 40, 104);
    SHOW_BKG;
    SHOW_SPRITES;
    if (saved[0] == 0x6D) {
        textCursorPosX = saved[1];
        textCursorPosY = saved[2];
        currentCharacter = saved[3];
        for (i = 0; i < 18; i++) {
            iconPositions[i] = saved[4 + i];
        }
        for (i = 0; i < 6; i++) {
            emptyFiles[i] = saved[22 + i];
        }
        for (i = 0; i < 9; i++) {
            if (emptyFiles[i] && i < 6) continue;
            showSprite(i);
        }
        num16 b;
        for (i = 0; i < 7; i++) {
            for (b = 0; b < 320; b++) {
                fileData[i][b] = saved[i * 320 + b + 28];
            }
        }
        calcNumber = (saved[2588] << 8) | saved[2589];
        calcNumber1 = (saved[2590] << 8) | saved[2591];
        calcNumber2 = (saved[2592] << 8) | saved[2593];
        operation = saved[2594];
    }
    while (1) {
        wait_vbl_done();
        handleInput();
        if (openedApp == 1 && justpressed & J_A) {
            if (cursorPosX >= 24 && cursorPosY >= 56 && cursorPosX < 136 && cursorPosY < 64) {
                saved[0] = 0x6D;
                saved[1] = textCursorPosX;
                saved[2] = textCursorPosY;
                saved[3] = currentCharacter;
                for (i = 0; i < 18; i++) {
                    saved[4 + i] = iconPositions[i];
                }
                for (i = 0; i < 6; i++) {
                    saved[22 + i] = emptyFiles[i];
                }
                num16 b;
                for (i = 0; i < 7; i++) {
                    for (b = 0; b < 320; b++) {
                        saved[i * 320 + b + 28] = fileData[i][b];
                    }
                }
                saved[2588] = (calcNumber >> 8) & 0xFF;
                saved[2589] = calcNumber & 0xFF;
                saved[2590] = (calcNumber1 >> 8) & 0xFF;
                saved[2591] = calcNumber1 & 0xFF;
                saved[2592] = (calcNumber2 >> 8) & 0xFF;
                saved[2593] = calcNumber2 & 0xFF;
                saved[2594] = operation;
            }
            if (cursorPosX >= 40 && cursorPosY >= 64 && cursorPosX < 120 && cursorPosY < 72) {
                saved[0] = 0x00;
                set_bkg_tiles(0, 0, 20, 18, blank);
                openedApp = 0;
                drawText("please restart", 3, 7);
            }
        }
        if (openedApp == 2) {
            if (justpressed & J_B && cursorPosY < 128) {
                textCursorPosX = cursorPosX / 8;
                textCursorPosY = cursorPosY / 8;
            }
            if (justpressed & J_A) {
                if (cursorPosX >= 80 && cursorPosX < 88 && cursorPosY >= 136) {
                    currentCharacter--;
                    if (currentCharacter == 19) currentCharacter = 0;
                    if (currentCharacter == 255) currentCharacter = 90;
                    set_bkg_tiles(11, 17, 1, 1, &currentCharacter);
                }
                else if (cursorPosX >= 96 && cursorPosX < 104 && cursorPosY >= 136) {
                    currentCharacter++;
                    if (currentCharacter == 91) currentCharacter = 0;
                    if (currentCharacter == 1) currentCharacter = 20;
                    set_bkg_tiles(11, 17, 1, 1, &currentCharacter);
                }
                else if (cursorPosX >= 112 && cursorPosX < 120 && cursorPosY >= 136) {
                    emptyFiles[0] = 0;
                    num x;
                    num y;
                    for (x = 0; x < 20; x++) {
                        for (y = 0; y < 16; y++) {
                            fileData[0][y * 20 + x] = fileData[6][y * 20 + x];
                        }
                    }
                }
                else if (cursorPosX >= 120 && cursorPosX < 128 && cursorPosY >= 136) {
                    emptyFiles[1] = 0;
                    num x;
                    num y;
                    for (x = 0; x < 20; x++) {
                        for (y = 0; y < 16; y++) {
                            fileData[1][y * 20 + x] = fileData[6][y * 20 + x];
                        }
                    }
                }
                else if (cursorPosX >= 128 && cursorPosX < 136 && cursorPosY >= 136) {
                    emptyFiles[2] = 0;
                    num x;
                    num y;
                    for (x = 0; x < 20; x++) {
                        for (y = 0; y < 16; y++) {
                            fileData[2][y * 20 + x] = fileData[6][y * 20 + x];
                        }
                    }
                }
                else if (cursorPosX >= 136 && cursorPosX < 144 && cursorPosY >= 136) {
                    emptyFiles[3] = 0;
                    num x;
                    num y;
                    for (x = 0; x < 20; x++) {
                        for (y = 0; y < 16; y++) {
                            fileData[3][y * 20 + x] = fileData[6][y * 20 + x];
                        }
                    }
                }
                else if (cursorPosX >= 144 && cursorPosX < 152 && cursorPosY >= 136) {
                    emptyFiles[4] = 0;
                    num x;
                    num y;
                    for (x = 0; x < 20; x++) {
                        for (y = 0; y < 16; y++) {
                            fileData[4][y * 20 + x] = fileData[6][y * 20 + x];
                        }
                    }
                }
                else if (cursorPosX >= 152 && cursorPosX < 168 && cursorPosY >= 136) {
                    emptyFiles[5] = 0;
                    num x;
                    num y;
                    for (x = 0; x < 20; x++) {
                        for (y = 0; y < 16; y++) {
                            fileData[5][y * 20 + x] = fileData[6][y * 20 + x];
                        }
                    }
                }
                else if (cursorPosX >= 32 || cursorPosY < 136) {
                    fileData[6][textCursorPosY * 20 + textCursorPosX] = currentCharacter;
                    set_bkg_tiles(textCursorPosX, textCursorPosY, 1, 1, &currentCharacter);
                    textCursorPosX++;
                    if (textCursorPosX == 20) {
                        textCursorPosX = 0;
                        textCursorPosY++;
                    }
                    if (textCursorPosY == 16) textCursorPosY = 0;
                }
            }
            if (justpressed & J_SELECT) {
                textCursorPosX--;
                if (textCursorPosX == 255) {
                    textCursorPosX = 19;
                    textCursorPosY--;
                }
                if (textCursorPosY == 255) {
                    textCursorPosX = 0;
                    textCursorPosY = 0;
                    continue;
                }
                fileData[6][textCursorPosY * 20 + textCursorPosX] = 0;
                set_bkg_tiles(textCursorPosX, textCursorPosY, 1, 1, blank);
            }
            if (justpressed & J_START && (cursorPosX >= 32 || cursorPosY < 136)) {
                fileData[6][cursorPosY / 8 * 20 + cursorPosX / 8] = currentCharacter;
                set_bkg_tiles(cursorPosX / 8, cursorPosY / 8, 1, 1, &currentCharacter);
            }
            move_sprite(1, textCursorPosX * 8 + 8, textCursorPosY * 8 + 16);
        }
        if (openedApp == 3 && justpressed & J_A) {
            num redraw = 1;
            if (cursorPosX >= 24 && cursorPosY >= 104 && cursorPosX < 32 && cursorPosY < 112) calcNumber = 0;
            if (cursorPosX >= 40 && cursorPosY >= 104 && cursorPosX < 48 && cursorPosY < 112 && !(calcNumber / 1000)) calcNumber *= 10;
            if (cursorPosX >= 56 && cursorPosY >= 104 && cursorPosX < 64 && cursorPosY < 112) calcNumber /= 10;
            if (cursorPosX >= 24 && cursorPosY >= 88 && cursorPosX < 32 && cursorPosY < 96 && !(calcNumber / 1000)) calcNumber = calcNumber * 10 + 1;
            if (cursorPosX >= 40 && cursorPosY >= 88 && cursorPosX < 48 && cursorPosY < 96 && !(calcNumber / 1000)) calcNumber = calcNumber * 10 + 2;
            if (cursorPosX >= 56 && cursorPosY >= 88 && cursorPosX < 64 && cursorPosY < 96 && !(calcNumber / 1000)) calcNumber = calcNumber * 10 + 3;
            if (cursorPosX >= 24 && cursorPosY >= 72 && cursorPosX < 32 && cursorPosY < 80 && !(calcNumber / 1000)) calcNumber = calcNumber * 10 + 4;
            if (cursorPosX >= 40 && cursorPosY >= 72 && cursorPosX < 48 && cursorPosY < 80 && !(calcNumber / 1000)) calcNumber = calcNumber * 10 + 5;
            if (cursorPosX >= 56 && cursorPosY >= 72 && cursorPosX < 64 && cursorPosY < 80 && !(calcNumber / 1000)) calcNumber = calcNumber * 10 + 6;
            if (cursorPosX >= 24 && cursorPosY >= 56 && cursorPosX < 32 && cursorPosY < 64 && !(calcNumber / 1000)) calcNumber = calcNumber * 10 + 7;
            if (cursorPosX >= 40 && cursorPosY >= 56 && cursorPosX < 48 && cursorPosY < 64 && !(calcNumber / 1000)) calcNumber = calcNumber * 10 + 8;
            if (cursorPosX >= 56 && cursorPosY >= 56 && cursorPosX < 64 && cursorPosY < 64 && !(calcNumber / 1000)) calcNumber = calcNumber * 10 + 9;
            if (cursorPosX >= 88 && cursorPosY >= 56 && cursorPosX < 104 && cursorPosY < 64) {
                calcNumber1 = 0;
                calcNumber2 = 0;
                calcNumber = 0;
                operation = 0;
            }
            if (cursorPosX >= 112 && cursorPosY >= 56 && cursorPosX < 120 && cursorPosY < 64) {
                calcNumber1 = calcNumber;
                calcNumber = 0;
                operation = 0;
                redraw = 0;
            }
            if (cursorPosX >= 128 && cursorPosY >= 56 && cursorPosX < 136 && cursorPosY < 64) {
                calcNumber1 = calcNumber;
                calcNumber = 0;
                operation = 1;
                redraw = 0;
            }
            if (cursorPosX >= 112 && cursorPosY >= 72 && cursorPosX < 120 && cursorPosY < 80) {
                calcNumber1 = calcNumber;
                calcNumber = 0;
                operation = 2;
                redraw = 0;
            }
            if (cursorPosX >= 128 && cursorPosY >= 56 && cursorPosX < 136 && cursorPosY < 80) {
                calcNumber1 = calcNumber;
                calcNumber = 0;
                operation = 3;
                redraw = 0;
            }
            if (cursorPosX >= 128 && cursorPosY >= 88 && cursorPosX < 136 && cursorPosY < 96) {
                calcNumber2 = calcNumber;
                if (operation == 0) calcNumber = calcNumber1 + calcNumber2;
                if (operation == 1) calcNumber = calcNumber1 - calcNumber2;
                if (operation == 2) calcNumber = calcNumber1 * calcNumber2;
                if (operation == 3) calcNumber = calcNumber1 / calcNumber2;
                calcNumber %= 10000;
            }
            if (redraw) drawSegmentedDisplay(calcNumber, 5, 1);
        }
        if (openedApp == 0) {
            snum hoveredIcon = -1;
            for (i = 0; i < 9; i++) {
                if (hidden[i]) continue;
                num x = getSpriteX(i);
                num y = getSpriteY(i);
                if (cursorPosX >= x && cursorPosY >= y && cursorPosX < x + 16 && cursorPosY < y + 16) {
                    hoveredIcon = i;
                    break;
                }
            }
            if (prevHoveredIcon != hoveredIcon) {
                prevHoveredIcon = hoveredIcon;
                set_bkg_tiles(0, 17, 20, 1, blank);
                if (hoveredIcon >= 0 && hoveredIcon < 6) {
                    num number[1];
                    number[0] = 71 + hoveredIcon;
                    drawText("file", 0, 17);
                    set_bkg_tiles(5, 17, 1, 1, number);
                }
                if (hoveredIcon == 6) drawText("save", 0, 17);
                if (hoveredIcon == 7) drawText("file editor", 0, 17);
                if (hoveredIcon == 8) drawText("calculator", 0, 17);
            }
            if (justpressed & J_B) grabbedSprite = hoveredIcon;
            if (!(pressed & J_B)) grabbedSprite = -1;
            if (justpressed & J_A && hoveredIcon >= 0) {
                for (i = 0; i < 9; i++) {
                    hideSprite(i);
                }
                set_bkg_tiles(0, 17, 20, 1, blank);
                set_bkg_tiles(0, 0, 20, 16, blank);
                drawText("exit", 0, 17);
                if (hoveredIcon >= 6) openedApp = hoveredIcon - 5;
                else openedApp = 2;
                if (openedApp == 1) {
                    num questionMark = 81;
                    drawText("save to cartridge", 1, 1);
                    drawText("overwrite save", 3, 7);
                    drawText("reset save", 5, 8);
                    set_bkg_tiles(18, 1, 1, 1, &questionMark);
                }
                if (openedApp == 2) {
                    move_sprite(1, textCursorPosX * 8 + 8, textCursorPosY * 8 + 16);
                    set_bkg_tiles(10, 17, 10, 1, texteditToolbar);
                    set_bkg_tiles(11, 17, 1, 1, &currentCharacter);
                    set_bkg_tiles(0, 0, 20, 16, fileData[hoveredIcon == 7 ? 6 : hoveredIcon]);
                }
                if (openedApp == 3) {
                    set_bkg_tiles(1, 0, 18, 16, calc);
                    drawSegmentedDisplay(calcNumber, 5, 1);
                }
            }
            cursorLimitUp = (grabbedSprite == -1 ? 0 : 8);
            cursorLimitLeft = (grabbedSprite == -1 ? 0 : 8);
            cursorLimitDown = (grabbedSprite == -1 ? 143 : 119);
            cursorLimitRight = (grabbedSprite == -1 ? 159 : 151);
            if (cursorPosY < cursorLimitUp) cursorPosY = cursorLimitUp;
            if (cursorPosX < cursorLimitLeft) cursorPosX = cursorLimitLeft;
            if (cursorPosY >= cursorLimitDown) cursorPosY = cursorLimitDown;
            if (cursorPosX >= cursorLimitRight) cursorPosX = cursorLimitRight;
            if (grabbedSprite != -1) {
                if (grabbedSprite < 6 && cursorPosX >= 144 && cursorPosY < 16) {
                    moveSprite(grabbedSprite, 8 + grabbedSprite * 16, 24 + grabbedSprite * 4);
                    hideSprite(grabbedSprite);
                    emptyFiles[grabbedSprite] = 1;
                } 
                else moveSprite(grabbedSprite, cursorPosX - 8, cursorPosY - 8);
            }
        }
        else if (cursorPosX < 32 && cursorPosY >= 136 && justpressed & J_A) {
            openedApp = 0;
            grabbedSprite = 11;
            set_bkg_tiles(0, 0, 20, 16, blank);
            set_bkg_tiles(18, 0, 2, 2, trashBin);
            for (i = 0; i < 9; i++) {
                if (i < 6 && emptyFiles[i]) continue;
                showSprite(i);
            }
            hide_sprite(1);
        }
        if (pressed & J_UP && cursorPosY != 0) cursorPosY--;
        if (pressed & J_LEFT && cursorPosX != 0) cursorPosX--;
        if (pressed & J_DOWN) cursorPosY++;
        if (pressed & J_RIGHT) cursorPosX++;
        if (cursorPosY < cursorLimitUp) cursorPosY = cursorLimitUp;
        if (cursorPosX < cursorLimitLeft) cursorPosX = cursorLimitLeft;
        if (cursorPosY >= cursorLimitDown) cursorPosY = cursorLimitDown;
        if (cursorPosX >= cursorLimitRight) cursorPosX = cursorLimitRight;
        move_sprite(0, cursorPosX + 8, cursorPosY + 16);
    }
    return 0;
}
